<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>المرشحون للانتخابات</title>
    <style>
        body {
            font-family: "Cairo", "Tahoma", sans-serif;
            padding: 30px;
            background-color: #f0f4f8;
            direction: rtl;
            line-height: 1.7;
            /* Add padding to the top of the body to prevent content from being hidden by the fixed bar */
            padding-top: 100px; /* Adjust this value based on the height of the fixed bar */
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 35px;
            border-radius: 14px;
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #007bff;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 25px;
            text-align: right;
            font-size: 1.8em;
            font-weight: 700;
        }
        .login-link {
            text-align: left;
            margin-bottom: 20px;
        }
        .login-link a {
            color: purple;
            text-decoration: none;
            font-weight: 600;
        }
        .login-link a:hover {
            text-decoration: underline;
        }

        /* --- NEW STYLES for Fixed Button Bar --- */
        .fixed-actions-bar {
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            z-index: 1000; /* Ensure it stays on top of other content */
            background-color: #e6f7ff; /* Light background for visibility */
            padding: 10px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .fixed-actions-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 0 35px; /* Match container padding */
        }
        /* --- END NEW STYLES --- */

        /* Candidate Card Styles */
        .candidate-card {
            background-color: #f9fbfc;
            padding: 20px;
            border-radius: 10px;
            border-right: 6px solid #10A3D6;
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s;
            position: relative;
        }
        .candidate-card:hover {
            background-color: #e6f7ff;
        }

        /* Radio button on top */
        .radio-top {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }
        .radio-top input[type="radio"] {
            transform: scale(1.3);
            cursor: pointer;
        }

        /* Candidate info layout */
        .candidate-inner {
            display: flex;
            align-items: flex-start;
        }
        label.candidate-inner {
            display: flex;
            flex: 1;
            flex-direction: row-reverse;
            gap: 15px;
            cursor: pointer;
            align-items: flex-start;
        }

        /* Smaller photo size */
        .candidate-photo {
            width: 100px;
            height: 120px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid #007bff;
            flex-shrink: 0;
        }

        .candidate-info {
            color: #333;
            text-align: right;
            flex-grow: 1;
        }
        .candidate-info strong {
            display: block;
            color: #0d6efd;
            font-size: 1.3em;
            margin-bottom: 6px;
        }
        .candidate-info small {
            color: #6c757d;
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
        }

        /* COLLAPSIBLE BIO STYLES (from previous step) */
        .candidate-description-wrapper {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out;
            margin-top: 10px;
            padding-bottom: 5px;
        }
        .candidate-description-wrapper.expanded {
            max-height: 1000px;
            transition: max-height 0.6s ease-in;
        }
        .candidate-description {
            padding-top: 10px;
            border-top: 1px dashed #e9ecef;
            line-height: 1.8;
        }
        .candidate-description p {
            margin: 8px 0;
            font-size: 1em;
            line-height: 1.8;
        }
        .read-more-btn {
            background: none;
            color: #007bff;
            border: none;
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            margin-top: 5px;
            font-size: 0.95em;
            text-align: right;
            display: block;
            text-decoration: underline;
        }
        .read-more-btn:hover {
            color: #0d6efd;
        }
        
        /* Buttons */
        /* Adjusted margins to look better inside the fixed bar */
        .vote-btn,
        .results-btn {
            width: 180px;
            text-align: center;
            margin-right: 0; /* Removed fixed margin-right */
            margin-bottom: 0; /* Removed fixed margin-bottom */
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1em;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            box-sizing: border-box;
            transition: background-color 0.3s, transform 0.1s;
        }
        .vote-btn {
            background-color: #10A3D6;
            color: white;
            border: none;
        }
        .vote-btn:hover {
            background-color: #0c82ab;
            transform: scale(1.03);
        }
        .results-btn {
            background-color: purple;
            color: white;
            border: none;
        }
        .results-btn:hover {
            background-color: #5a1a8e;
            transform: scale(1.03);
        }

        /* Messages */
        .message, .warning {
            padding: 12px 18px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: right;
            font-weight: 500;
        }
        .message {
            background-color: #d1e7dd;
            color: #0f5132;
            border: 1px solid #badbcc;
        }
        .warning {
            background-color: #f8d7da;
            color: #842029;
            border: 1px solid #f5c2c7;
        }

        /* Mobile Responsiveness */
        @media (max-width: 600px) {
            body { 
                padding: 15px; 
                padding-top: 130px; /* Increased top padding for mobile */
            }
            .container { padding: 20px; }
            .candidate-inner {
                flex-direction: column-reverse;
                align-items: center;
            }
            .candidate-photo {
                width: 100%;
                max-width: 100px;
                height: 120px;
                margin-bottom: 15px;
            }
            .candidate-info {
                text-align: center;
            }
            .radio-top {
                justify-content: center;
                width: 100%;
            }
            /* Buttons are now flexible in the fixed bar, but we ensure they take full width in mobile */
            .vote-btn,
            .results-btn {
                width: 100%;
                margin: 5px 0; /* Small vertical margin for separation */
            }
            .fixed-actions-content {
                padding: 0 15px; /* Adjust padding for mobile */
                flex-direction: column; /* Stack buttons vertically on mobile */
            }
        }
    </style>
</head>
<body>

<div class="fixed-actions-bar">
    <div class="fixed-actions-content">
        {% if candidates_with_votes %}
            <form method="POST" action="{% url 'submit_vote' %}" style="display:contents;">
                {% csrf_token %}

                {% if not voting_closed %}
                    <button type="submit" class="vote-btn">صوّت</button>
                {% endif %}
                {% if is_candidate %}
                    <a href="{% url 'candidate_results' %}" class="vote-btn">عرض نتائجي</a>
                {% endif %}
                {% if user.is_authenticated and user.candidate %}
                    <a href="{% url 'all_users' %}" class="vote-btn">عرض جميع المستخدمين</a>
                {% endif %}
            </form>
        {% endif %}
    </div>
</div>
<div class="container">
    <div class="login-link">
        {% if user.is_authenticated %}
            <a href="{% url 'logout' %}">تسجيل الخروج</a>
        {% else %}
            <a href="{% url 'login' %}">تسجيل دخول المرشح</a>
        {% endif %}
    </div>

    <h1>المرشحون للانتخابات</h1>

    {% if messages %}
        {% for message in messages %}
            <div class="message">{{ message }}</div>
        {% endfor %}
    {% endif %}

    {% if is_admin %}
        {% else %}
        {% if voting_closed %}
            <div class="warning">
                انتهت فترة التصويت. لم يعد بالإمكان التصويت أو تعديل الأصوات بعد {{ deadline }}.
            </div>
        {% else %}
            {% if has_voted and voted_for_name %}
                <p><strong>لقد أدليت بصوتك سابقاً لصالح {{ voted_for_name }}. يمكنك تحديث اختيارك أدناه حتى {{ deadline }}:</strong></p>
            {% endif %}
        {% endif %}

        {% if candidates_with_votes %}
            {% for item in candidates_with_votes %}
                <div class="candidate-card">
                    <div class="radio-top">
                        <input type="radio" name="vote" form="vote-form"
                               value="{{ item.candidate.id }}"
                               id="candidate{{ item.candidate.id }}"
                               {% if item.candidate.id == voted_candidate_id %}checked{% endif %}
                               {% if voting_closed %}disabled{% endif %}>
                        <span>صوت لهذا المرشح</span>
                    </div>

                    <label for="candidate{{ item.candidate.id }}" class="candidate-inner">
                        {% if item.candidate.image %}
                            <img src="{{ item.candidate.image.url }}" alt="{{ item.candidate.name }}" class="candidate-photo">
                        {% endif %}
                        <div class="candidate-info">
                            <strong>{{ item.candidate.name }}</strong>
                            <small>{{ item.candidate.party }}</small>
                            
                            <button type="button" class="read-more-btn"
                                    id="read-more-btn-{{ item.candidate.id }}"
                                    onclick="toggleReadMore('description-wrapper-{{ item.candidate.id }}', this)">
                                اقرأ المزيد
                            </button>
                            
                            <div id="description-wrapper-{{ item.candidate.id }}" class="candidate-description-wrapper">
                                <div class="candidate-description">
                                    {{ item.candidate.description|safe }}
                                </div>
                            </div>
                        </div>
                    </label>
                </div>
            {% endfor %}
            
            <form method="POST" action="{% url 'submit_vote' %}" id="vote-form" style="display:none;">
                {% csrf_token %}
            </form>
            
        {% else %}
            <p style="text-align: right;">لم يتم تسجيل مرشحين بعد.</p>
        {% endif %}
    {% endif %}
</div>

<script>
    /**
     * Toggles the 'expanded' class on the description wrapper to show/hide the full content.
     * @param {string} wrapperId - The ID of the .candidate-description-wrapper element.
     * @param {HTMLElement} button - The 'اقرأ المزيد' button element.
     */
    function toggleReadMore(wrapperId, button) {
        const wrapper = document.getElementById(wrapperId);
        
        // Find the specific card element to scroll to
        const card = wrapper.closest('.candidate-card');

        if (wrapper.classList.contains('expanded')) {
            // Collapse
            wrapper.classList.remove('expanded');
            button.textContent = 'اقرأ المزيد';
            button.style.textDecoration = 'underline'; // Add underline back

            // Scroll the card back into view when collapsing
            card.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' });
        } else {
            // Expand
            wrapper.classList.add('expanded');
            button.textContent = 'إخفاء التفاصيل';
            button.style.textDecoration = 'none'; // Remove underline when expanded
        }
    }
</script>
</body>
</html>
